From cfd174db7adde8508293c76fee6b173687f4ed43 Mon Sep 17 00:00:00 2001
From: Francois Berenger <unixjunkie@sdf.org>
Date: Wed, 31 Jul 2019 15:40:56 +0900
Subject: [PATCH 40/42] BatUnix: 4.08 compat

---
 src/batUnix.mliv | 63 ++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 63 insertions(+)

diff --git a/src/batUnix.mliv b/src/batUnix.mliv
index 029dd950..5a4def97 100644
--- a/src/batUnix.mliv
+++ b/src/batUnix.mliv
@@ -311,6 +311,9 @@ val openfile : string -> open_flag list -> file_perm -> file_descr
 val close : file_descr -> unit
 (** Close a file descriptor. *)
 
+##V>=4.08##val fsync : file_descr -> unit
+##V>=4.08##(** Flush file buffers to disk. *)
+
 val read : file_descr -> Bytes.t -> int -> int -> int
 (** [read fd buff ofs len] reads [len] characters from descriptor
     [fd], storing them in string [buff], starting at position [ofs]
@@ -805,6 +808,66 @@ val open_process_full :
     the process yourself to ensure proper cleanup.
 *)
 
+##V>=4.08##val open_process_args_in : string -> string array -> in_channel
+##V>=4.08##(** High-level pipe and process management. The first argument specifies the
+##V>=4.08##   command to run, and the second argument specifies the argument array passed
+##V>=4.08##   to the command.  This function runs the command in parallel with the program.
+##V>=4.08##   The standard output of the command is redirected to a pipe, which can be read
+##V>=4.08##   via the returned input channel.
+##V>=4.08##
+##V>=4.08##    @since 4.08.0 *)
+
+##V>=4.08##val open_process_args_out : string -> string array -> out_channel
+##V>=4.08##(** Same as {!Unix.open_process_args_in}, but redirect the standard input of the
+##V>=4.08##   command to a pipe.  Data written to the returned output channel is sent to
+##V>=4.08##   the standard input of the command.  Warning: writes on output channels are
+##V>=4.08##   buffered, hence be careful to call {!Stdlib.flush} at the right times to
+##V>=4.08##   ensure correct synchronization.
+##V>=4.08##
+##V>=4.08##    @since 4.08.0 *)
+
+##V>=4.08##val open_process_args : string -> string array -> in_channel * out_channel
+##V>=4.08##(** Same as {!Unix.open_process_args_out}, but redirects both the standard input
+##V>=4.08##   and standard output of the command to pipes connected to the two returned
+##V>=4.08##   channels.  The input channel is connected to the output of the command, and
+##V>=4.08##   the output channel to the input of the command.
+##V>=4.08##
+##V>=4.08##    @since 4.08.0 *)
+
+##V>=4.08##val open_process_args_full :
+##V>=4.08##  string -> string array -> string array ->
+##V>=4.08##    in_channel * out_channel * in_channel
+##V>=4.08##(** Similar to {!Unix.open_process_args}, but the third argument specifies the
+##V>=4.08##   environment passed to the command.  The result is a triple of channels
+##V>=4.08##   connected respectively to the standard output, standard input, and standard
+##V>=4.08##   error of the command.
+##V>=4.08##
+##V>=4.08##    @since 4.08.0 *)
+
+##V>=4.08##val process_in_pid : in_channel -> int
+##V>=4.08##(** Return the pid of a process opened via {!Unix.open_process_in} or
+##V>=4.08##   {!Unix.open_process_args_in}.
+##V>=4.08##
+##V>=4.08##    @since 4.08.0 *)
+
+##V>=4.08##val process_out_pid : out_channel -> int
+##V>=4.08##(** Return the pid of a process opened via {!Unix.open_process_out} or
+##V>=4.08##   {!Unix.open_process_args_out}.
+##V>=4.08##
+##V>=4.08##    @since 4.08.0 *)
+
+##V>=4.08##val process_pid : in_channel * out_channel -> int
+##V>=4.08##(** Return the pid of a process opened via {!Unix.open_process} or
+##V>=4.08##   {!Unix.open_process_args}.
+##V>=4.08##
+##V>=4.08##    @since 4.08.0 *)
+
+##V>=4.08##val process_full_pid : in_channel * out_channel * in_channel -> int
+##V>=4.08##(** Return the pid of a process opened via {!Unix.open_process_full} or
+##V>=4.08##   {!Unix.open_process_args_full}.
+##V>=4.08##
+##V>=4.08##    @since 4.08.0 *)
+
 val close_process_in : BatInnerIO.input -> process_status
 (** Close {!type:input} opened by {!Unix.open_process_in},
     wait for the associated command to terminate,
-- 
2.22.0

